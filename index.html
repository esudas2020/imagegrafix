<!DOCTYPE html>
<html>

<head>
    <title>App Default Screen</title>    
    
    <script src="https://code.jquery.com/jquery-3.6.1.js"></script>
    <style>
        div.a {
            line-height: 200%;
        }
    </style>
    <script>       	    
        function showInvoiceList() {

		var apiEndpoint = "https://accounts.zoho.in/oauth/v2/token?refresh_token=1000.854d65ca9c39e1a2d218251b74f9003b.a56a440d96dc721b5a453024cd33c044&client_id=1000.5Y3AZV8FIIVVH6VZJU0Y6726IEET6J&client_secret=bf29f2e7680b5dde78d746d0ae4236ace7d88ef792&grant_type=refresh_token";

		const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
		//https://cors-anywhere.herokuapp.com/corsdemo
		 const fullUrl = proxyUrl + apiEndpoint;
		 const xhr = new XMLHttpRequest();

    // Initialize a POST request to the full URL
    xhr.open('POST', fullUrl, true);

    // Set request headers
    xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');

    // Define the response handling logic
    xhr.onload = function() {
        if (xhr.status >= 200 && xhr.status < 300) {
            const response = JSON.parse(xhr.responseText);
document.getElementById('response').innerText = 'Response: ' + JSON.stringify(response, null, 2);
		
		const jsonResponse = JSON.parse(xhr.responseText);
            const accessToken = jsonResponse.access_token;
 document.getElementById('token').innerText = accessToken;
				
		var apiEndpoint1 = "https://projectsapi.zoho.in/restapi/portal/60004006068/projects/38707000004631005/milestones/";

		 const gfullUrl = proxyUrl + apiEndpoint1;
		 const gxhr = new XMLHttpRequest();
		 gxhr.open('GET', gfullUrl, true);
		 gxhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
		 gxhr.setRequestHeader('Authorization', 'Zoho-oauthtoken ' + accessToken); // Replace accessToken with your actual token

		 gxhr.onload = function() {
        if (gxhr.status >= 200 && gxhr.status < 300) {
            const response = JSON.parse(gxhr.responseText);
		
            document.getElementById('response').innerText = 'Response: ' + JSON.stringify(response, null, 2);

		const gjsonResponse = JSON.parse(gxhr.responseText);

		for (var i = 0; i < gjsonResponse.milestones.length; i++) {
    var select = document.getElementById("Select");
    var option = document.createElement("option");
    option.text = gjsonResponse.milestones[i].name;
    option.value = gjsonResponse.milestones[i].id;
    select.add(option);
}		
        } else {
            document.getElementById('response').innerText = 'Error: ' + gxhr.status + ' - ' + gxhr.statusText;
        }
    };
    // Handle request errors
    gxhr.onerror = function() {
        document.getElementById('response').innerText = 'Request failed.';
    };
    gxhr.send();
		
            
        } else {
            document.getElementById('response').innerText = 'Error: ' + xhr.status + ' - ' + xhr.statusText;
        }
    };

    // Handle request errors
    xhr.onerror = function() {
        document.getElementById('response').innerText = 'Request failed.';
    };

    // Send the request with the JSON-encoded data
    //xhr.send(JSON.stringify(postData));
		xhr.send();
		
		/*
$.post(zturl,null, function(data, status){
    alert("Data: " + data + "\nStatus: " + status);
  });
		
		$.ajax({
  url: zturl,
  method: "POST",
}).done(function( data ) {
    if ( console && console.log ) {
      alert( "done" );
    }
  }).fail(function() {
    alert( "error" );
  })
  .always(function() {
    alert( "finished" );
  });
		*/
		
		//var fproject_desc = getParameterByName('project_desc'); 
var params = new URL(window.location).searchParams;
var fproject_desc = params.get('project_desc');
            window.open("https://softwaresolutions.imagegrafix.in:8089/invoice/InvoiceList?Refference=" + fproject_desc);
        }

        function createInvoice() {
		var params = new URL(window.location).searchParams;
var project_desc = params.get('project_desc');
		//project_id, milestone, milestone_id			
var milestone_id = params.get('milestone_id');
		var milestone = params.get('milestone');
		var project_id = params.get('project_id');
            window.open("https://softwaresolutions.imagegrafix.in:8089/invoice/index?MileStone=" + milestone + "&Refference=" + project_desc + "&Milestone ID=" + milestone_id + "&Projectid=" + project_id);
        }
    </script>
</head>

<body>
    <p id="demo" style="font-size:20px"> </p>
    <button onclick="createInvoice()">Create Invoice</button>

    <button onclick="showInvoiceList()">Show Invoice List</button>
	
	<select id="Select" name="MileStoneList"></select>
	
	 <div id="token"></div>
 <div id="response"></div>

</body>

</html>
